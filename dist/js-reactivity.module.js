Object.prototype.compare=function(e,t){if(!e||!t)return!1;if(Object.keys(e).length!=Object.keys(t).length)return!1;for(var n in e){if(e.hasOwnProperty(n)!==t.hasOwnProperty(n))return!1;switch(typeof e[n]){case"object":if(!Object.compare(e[n],t[n]))return!1;break;case"function":if(void 0===t[n]||"compare"!=n&&e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}}for(var n in t)if(void 0===e[n])return!1;return!0},Array.prototype.inArray=function(e){return-1!==this.indexOf(e)},Array.prototype.pushIfNotExist=function(e){this.inArray(e)||this.push(e)},Array.prototype.getDiff=function(e){var t=[];return this.forEach(function(n,r){Object.compare(n,e[r])||t.push(r)}),t},Array.prototype.getLast=function(){return this[this.length-1]};var e=function(){function e(){}return e.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},e.getNested=function(e,t,n,r){return void 0===t&&(t=self),void 0===n&&(n=!1),void 0===r&&(r="."),e=n?"_refs."+e:e,(Array.isArray(e)?e:e.split(r)).reduce(function(e,t){return e&&e[t]},t)},e.flatObject=function(e){return Object.keys(e).reduce(function(t,n){return function e(t,n,r,o){var i;void 0===o&&(o="");var a=[o,n].filter(function(e){return e}).join(".");return"object"==typeof r?Object.keys(r).reduce(function(t,n){return e(t,n,r[n],a)},t):Object.assign(t,((i={})[a]=r,i))}(t,n,e[n])},{})},e.isNumber=function(e){return/^\d+$/.test(e)},e.getNestedFromObj=function(t){for(var n=null==t?void 0:t.scope,r="",o=null==t?void 0:t.name;!e.getNested(r+o,n,!0);){var i,a=null===(i=n)||void 0===i?void 0:i.appData.loop;if(!a)break;if(n=a.scope)r=a.name+"."+a.index+"."+r;else{var c=a.baseElement.appData.loop;n=c.scope,r=c.name+"."+a.index+"."+r}}return{controller:n,path:r+o,value:e.getNested(r+o,n,!0)}},e}();function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function a(e,t,n){return(a=i()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&o(i,n.prototype),i}).apply(null,arguments)}function c(e){var t="function"==typeof Map?new Map:void 0;return(c=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return a(e,arguments,r(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),o(n,e)})(e)}var u=function(){function e(){}return n(e,null,[{key:"elements",get:function(){return[].concat(e.variables,e.loops,e.conditions)}}]),e}();u.controllers=[],u.variables=[],u.loops=[],u.conditions=[],Element.prototype.setAppData=function(t,n){void 0===n&&(n=null),this.appData||(this.appData={}),n?this.appData[n]=t:this.appData=e.deepCopy(t)},Element.prototype.appendBefore=function(e){e.parentNode.insertBefore(this,e)},Element.prototype.appendAfter=function(e){e.parentNode.insertBefore(this,e.nextSibling)},Element.prototype.show=function(){this.classList.remove("hidden")},Element.prototype.hide=function(){this.classList.add("hidden")},Element.prototype.getController=function(e){var t=this.closest("[as="+e);return t?u.controllers[t.nodeName]:null},Element.prototype.getLoop=function(e){var t=this,n=null;return u.loops.forEach(function(r){var o=r.appData.loop;if(o.alias==e){if(r.contains(t))return void(n=r);o.siblingElements.forEach(function(e){e.contains(t)&&(n=e)})}}),n};var p={initControllers:function(){try{return document.querySelectorAll("[as]").forEach(function(e){var t=e.getAttribute("as");e.setAppData({name:t},"controller");var n=e.nodeName;u.controllers[n]||(u.controllers[n]=e)}),Promise.resolve()}catch(e){return Promise.reject(e)}},initLoops:function(){try{return document.querySelectorAll("[loop]").forEach(function(e){var t=e.getAttribute("loop").split(" "),n=t[2].match(/(.*?)\.(.*)/),r={index:0,scope:e.getController(n[1])||e.getLoop(n[1]),name:n[2],alias:t[0],baseElement:e,siblingElements:[],template:e.innerHTML};e.setAppData(r,"loop"),e.removeAttribute("loop"),u.loops.push(e),p.executeLoop(e).then(p.initLoops)}),Promise.resolve()}catch(e){return Promise.reject(e)}},executeLoop:function(t,n){void 0===n&&(n=[]);try{var r=t.appData.loop,o=r.siblingElements,i=e.getNestedFromObj(r).value;function a(e,n){void 0===n&&(n=1),e.forEach(function(e,r){if(r>=n){var i=document.createElement(t.nodeName);i.innerHTML=t.appData.loop.template,i.setAppData({index:r,baseElement:t},"loop"),i.appendAfter(o.getLast()||t),o.push(i)}})}if(n.length){var c=n.length-i.length;c>0?function(e){for(var t=0;t<e;t++)o[o.length-1]&&(o[o.length-1].remove(),o.pop());n.length=i.length}(c):c<0&&a(i,i.length+c),n.getDiff(i).forEach(function(e){!function(e){(0==e?t:o[e-1]).innerHTML=r.template}(e)})}else o.length=0,a(i);return Promise.resolve()}catch(e){return Promise.reject(e)}},initVariables:function(){document.querySelectorAll("[var]").forEach(function(e){var t=e.getAttribute("var"),n=t.match(/(.*?)\.(.*)/),r=n?n[1]:t,o={scope:e.getController(r)||e.getLoop(r),name:n?n[2]:[]};e.setAppData(o,"variable"),e.removeAttribute("var"),u.variables.push(e),p.executeVariable(e)})},executeVariable:function(t){var n=t.appData.variable,r=n.scope,o=n.name;if(r.appData.loop){var i=r.appData.loop,a=e.getNestedFromObj(i.baseElement.appData.loop).value;t.innerHTML=e.getNested(o,a[i.index])}else t.innerHTML=e.getNested(o,r,!0)},initConditions:function(){document.querySelectorAll("[if]").forEach(function(e){var t=e.getAttribute("if").match(/(.*?)\.(.*)/),n="!"==t[1].charAt(0);t[1]=t[1].replace("!","");var r={negative:n,scope:e.getController(t[1])||e.getLoop(t[1]),name:t[2]};e.setAppData(r,"condition"),e.removeAttribute("if"),u.conditions.push(e),p.executeCondition(e)})},executeCondition:function(t){var n=t.appData.condition;!!e.getNested(n.name,n.scope,!0)==!n.negative?t.show():t.hide()},initEvents:function(){document.querySelectorAll("[click]").forEach(function(t){if(!t.appData||!t.appData.event){var n=t.getAttribute("click").match(/(.*?)\.(.*)/),r={name:"click",scope:t.getController(n[1]),method:n[2].match(/(.*)(?=\()/)[1],properties:(o=n[2].match(/(?<=\()(.*)(?=\))/)[1].split(","),o=o.map(function(n){if(n){if(/^'.*'$/.test(n))return n.match(/(?<=')(.*)(?=')/)[1];var r=n.match(/(.*?)\.(.*)/),o=t.getController(r[1])||t.getLoop(r[1]);return e.getNested(r[2],o,!0)}return null}))};t.setAppData(r,"event"),t.addEventListener(r.name,function(){var e;return(e=r.scope)[r.method].apply(e,r.properties)})}var o})},cleanDom:function(){["as","loop","var","if"].forEach(function(e){document.querySelectorAll("["+e+"]").forEach(function(t){return t.removeAttribute(e)})})}},l=function(t){var r,o;function i(){var n,r=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n=t.call(this)||this);return n._refs=new Proxy({},{get:function(e,t){var n=e[t];return"object"==typeof n?new Proxy(n,this):n},set:function(t,n,o){var i=e.deepCopy(t);t[n]=o;var a=u.controllers[r.nodeName];if(a){var c=[];u.elements.forEach(function(t){for(var n in t.appData){var r;if((null===(r=t.appData[n].scope)||void 0===r?void 0:r.nodeName)==a.nodeName)c.pushIfNotExist(t);else{var o,i=null===(o=t.appData[n].scope)||void 0===o?void 0:o.appData.loop.baseElement.appData.loop,u=e.getNestedFromObj(i).controller;(null==u?void 0:u.nodeName)==a.nodeName&&c.pushIfNotExist(t)}}});var l=[];c.forEach(function(r){for(var i in r.appData){if(l.inArray(r))break;var a=[];e.isNumber(n)?a.push(t):"length"==n?a.push(t,o):a.push(o),(e.isNumber(n)||"length"==n||n==r.appData[i].name)&&a.forEach(function(t){var n,o;n=t,((o=e.getNestedFromObj(r.appData[i])).value===n||"object"==typeof n&&Object.compare(o.value,n))&&l.pushIfNotExist(r)})}}),l.forEach(function(e){e.appData.loop&&p.executeLoop(e,i).then(function(){p.initVariables(),p.initConditions(),p.initEvents()}),e.appData.variable&&p.executeVariable(e),e.appData.condition&&p.executeCondition(e)})}return!0}}),n}return o=t,(r=i).prototype=Object.create(o.prototype),r.prototype.constructor=r,r.__proto__=o,n(i,[{key:"refs",set:function(e){Object.assign(this._refs,e)},get:function(){return this._refs}}]),i}(c(HTMLElement)),s=function(){function e(){}return e.init=function(){try{return p.initControllers().then(function(){p.initLoops().then(function(){p.initVariables(),p.initConditions(),p.initEvents()})}),Promise.resolve()}catch(e){return Promise.reject(e)}},e}();export{l as Component,s as JsReactivity};
