!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).jsReactivity={})}(this,function(t){Object.prototype.compare=function(t,e){if(!t||!e)return!1;if(Object.keys(t).length!=Object.keys(e).length)return!1;for(var n in t){if(t.hasOwnProperty(n)!==e.hasOwnProperty(n))return!1;switch(typeof t[n]){case"object":if(!Object.compare(t[n],e[n]))return!1;break;case"function":if(void 0===e[n]||"compare"!=n&&t[n].toString()!=e[n].toString())return!1;break;default:if(t[n]!=e[n])return!1}}for(var n in e)if(void 0===t[n])return!1;return!0},Array.prototype.inArray=function(t){return-1!==this.indexOf(t)},Array.prototype.pushIfNotExist=function(t){this.inArray(t)||this.push(t)},Array.prototype.getDiff=function(t){var e=[];return this.forEach(function(n,r){Object.compare(n,t[r])||e.push(r)}),e},Array.prototype.getLast=function(){return this[this.length-1]};var e=function(){function t(){}return t.deepCopy=function(t){return JSON.parse(JSON.stringify(t))},t.getNested=function(t,e,n,r){return void 0===e&&(e=self),void 0===n&&(n=!1),void 0===r&&(r="."),t=n?"_refs."+t:t,(Array.isArray(t)?t:t.split(r)).reduce(function(t,e){return t&&t[e]},e)},t.flatObject=function(t){return Object.keys(t).reduce(function(e,n){return function t(e,n,r,o){var a;void 0===o&&(o="");var i=[o,n].filter(function(t){return t}).join(".");return"object"==typeof r?Object.keys(r).reduce(function(e,n){return t(e,n,r[n],i)},e):Object.assign(e,((a={})[i]=r,a))}(e,n,t[n])},{})},t.isNumber=function(t){return/^\d+$/.test(t)},t.getNestedFromObj=function(e){for(var n=e.scope,r="",o=e.name;!t.getNested(r+o,n,!0);){var a=n.appData.loop;if(!a)break;if(n=a.scope)r=a.name+"."+a.index+"."+r;else{var i=a.baseElement.appData.loop;n=i.scope,r=i.name+"."+a.index+"."+r}}return{controller:n,path:r+o,value:t.getNested(r+o,n,!0)}},t}();function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function i(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function c(t,e,n){return(c=i()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&a(o,n.prototype),o}).apply(null,arguments)}function p(t){var e="function"==typeof Map?new Map:void 0;return(p=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return c(t,arguments,o(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),a(n,t)})(t)}Element.prototype.setAppData=function(t,n){void 0===n&&(n=null),this.appData||(this.appData={}),n?this.appData[n]=t:this.appData=e.deepCopy(t)},Element.prototype.appendBefore=function(t){t.parentNode.insertBefore(this,t)},Element.prototype.appendAfter=function(t){t.parentNode.insertBefore(this,t.nextSibling)},Element.prototype.show=function(){this.classList.remove("hidden")},Element.prototype.hide=function(){this.classList.add("hidden")},Element.prototype.getController=function(t){var e=this.closest("[as="+t);return e?Store.controllers[e.nodeName]:null},Element.prototype.getLoop=function(t){var e=this,n=null;return Store.loops.forEach(function(r){var o=r.appData.loop;if(o.alias==t){if(r.contains(e))return void(n=r);o.siblingElements.forEach(function(t){t.contains(e)&&(n=t)})}}),n};var u=function(){function t(){}return r(t,null,[{key:"elements",get:function(){return[].concat(t.variables,t.loops,t.conditions)}}]),t}();u.controllers=[],u.variables=[],u.loops=[],u.conditions=[];var s=function(t){var e,n;function o(){var e,n=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e=t.call(this)||this);return e._refs=new Proxy({},{get:function(t,e){var n=t[e];return"object"==typeof n?new Proxy(n,this):n},set:function(t,e,r){var o=Util.deepCopy(t);t[e]=r;var a=u.controllers[n.nodeName];if(a){var i=[];u.elements.forEach(function(t){for(var e in t.appData)(t.appData[e].scope.nodeName==a.nodeName||Util.getNestedFromObj(t.appData[e].scope.appData.loop.baseElement.appData.loop).controller.nodeName==a.nodeName)&&i.pushIfNotExist(t)});var c=[];i.forEach(function(n){for(var o in n.appData){if(c.inArray(n))break;var a=[];Util.isNumber(e)?a.push(t):"length"==e?a.push(t,r):a.push(r),(Util.isNumber(e)||"length"==e||e==n.appData[o].name)&&a.forEach(function(t){var e,r;e=t,((r=Util.getNestedFromObj(n.appData[o])).value===e||"object"==typeof e&&Object.compare(r.value,e))&&c.pushIfNotExist(n)})}}),c.forEach(function(t){t.appData.loop&&executeLoop(t,o).then(function(){initVariables(),initConditions(),initEvents()}),t.appData.variable&&executeVariable(t),t.appData.condition&&executeCondition(t)})}return!0}}),e}return n=t,(e=o).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n,r(o,[{key:"refs",set:function(t){Object.assign(this._refs,t)},get:function(){return this._refs}}]),o}(p(HTMLElement)),f=function(){function t(){}return t.init=function(){window.addEventListener("DOMContentLoaded",function(){(function(){try{return document.querySelectorAll("[as]").forEach(function(t){var e=t.getAttribute("as");t.setAppData({name:e},"controller");var n=t.nodeName;u.controllers[n]||(u.controllers[n]=t)}),Promise.resolve()}catch(t){return Promise.reject(t)}})().then(function(){(function t(){try{return document.querySelectorAll("[loop]").forEach(function(n){var r=n.getAttribute("loop").split(" "),o=r[2].match(/(.*?)\.(.*)/),a={index:0,scope:n.getController(o[1])||n.getLoop(o[1]),name:o[2],alias:r[0],baseElement:n,siblingElements:[],template:n.innerHTML};n.setAppData(a,"loop"),n.removeAttribute("loop"),u.loops.push(n),function(t,n,r,o){void 0===n&&(n=[]);try{var a=function(e,n){void 0===n&&(n=1),e.forEach(function(e,r){if(r>=n){var o=document.createElement(t.nodeName);o.innerHTML=t.appData.loop.template,o.setAppData({index:r,baseElement:t},"loop"),o.appendAfter(c.getLast()||t),c.push(o)}})},i=t.appData.loop,c=i.siblingElements,p=e.getNestedFromObj(i).value;if(n.length){var u=n.length-p.length;u>0?function(t){for(var e=0;e<t;e++)c[c.length-1]&&(c[c.length-1].remove(),c.pop());n.length=p.length}(u):u<0&&a(p,p.length+u),n.getDiff(p).forEach(function(e){!function(e){(0==e?t:c[e-1]).innerHTML=i.template}(e)})}else c.length=0,a(p);return Promise.resolve()}catch(t){return Promise.reject(t)}}(n).then(t)}),Promise.resolve()}catch(t){return Promise.reject(t)}})().then(function(){document.querySelectorAll("[var]").forEach(function(t){var n=t.getAttribute("var"),r=n.match(/(.*?)\.(.*)/),o=r?r[1]:n,a={scope:t.getController(o)||t.getLoop(o),name:r?r[2]:[]};t.setAppData(a,"variable"),t.removeAttribute("var"),u.variables.push(t),function(t){var n=t.appData.variable,r=n.scope,o=n.name;if(r.appData.loop){var a=r.appData.loop,i=e.getNestedFromObj(a.baseElement.appData.loop).value;t.innerHTML=e.getNested(o,i[a.index])}else t.innerHTML=e.getNested(o,r,!0)}(t)}),document.querySelectorAll("[if]").forEach(function(t){var n=t.getAttribute("if").match(/(.*?)\.(.*)/),r="!"==n[1].charAt(0);n[1]=n[1].replace("!","");var o={negative:r,scope:t.getController(n[1])||t.getLoop(n[1]),name:n[2]};t.setAppData(o,"condition"),t.removeAttribute("if"),u.conditions.push(t),function(t){var n=t.appData.condition;!!e.getNested(n.name,n.scope,!0)==!n.negative?t.show():t.hide()}(t)}),document.querySelectorAll("[click]").forEach(function(t){if(!t.appData||!t.appData.event){var n=t.getAttribute("click").match(/(.*?)\.(.*)/),r={name:"click",scope:t.getController(n[1]),method:n[2].match(/(.*)(?=\()/)[1],properties:(o=n[2].match(/(?<=\()(.*)(?=\))/)[1].split(","),o=o.map(function(n){if(n){if(/^'.*'$/.test(n))return n.match(/(?<=')(.*)(?=')/)[1];var r=n.match(/(.*?)\.(.*)/),o=t.getController(r[1])||t.getLoop(r[1]);return e.getNested(r[2],o,!0)}return null}))};t.setAppData(r,"event"),t.addEventListener(r.name,function(){var t;return(t=r.scope)[r.method].apply(t,r.properties)})}var o})})})})},t}();t.Component=s,t.JsReactivity=f});
